<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Loading...</title>
<style>
html, body {
  margin:0; padding:0; height:100%; overflow:hidden; background:#000; color:#fff;
  font-family: Arial, sans-serif;
}
#loading {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}
.spinner {
  width: 40px; height: 40px;
  border: 4px solid rgba(255,255,255,0.3);
  border-top: 4px solid #fff;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin: 0 auto 10px;
}
@keyframes spin {0% {transform:rotate(0deg);}100% {transform:rotate(360deg);}}
#content {
  display: none;
  width: 100%; height: 100%;
  overflow:auto;
  -webkit-overflow-scrolling: touch;
  text-align:center;
  padding-top:30%;
}
.button {
  display:inline-block; padding:10px 20px; background:#fff; color:#000; border-radius:5px; text-decoration:none; margin-top:20px;
}
</style>
</head>
<body>

<div id="loading">
  <div class="spinner"></div>
  <div>Loading...</div>
</div>

<div id="content">
  <h1 style="color:white;">防红页面已加载</h1>
  <p>正在为您自动跳转...</p>
  <a id="gotoBtn" class="button" href="#" target="_blank">点击访问</a>
</div>

<script>
// 随机参数防缓存
function randomString(len=8){ return Math.random().toString(36).substr(2,len); }
(function ensureRandomParam(){
  const url = new URL(location.href);
  if(!url.searchParams.get("r")){
    url.searchParams.set("r", randomString());
    location.replace(url.toString());
  }
})();

// 获取参数
function getParam(name){
  const url = new URL(location.href);
  return url.searchParams.get(name);
}

// 主逻辑
const enc = getParam('u')||'';
if(!enc){
  document.body.innerHTML='<h1 style="color:white;text-align:center;margin-top:20%;">Invalid link</h1>';
}else{
  const jumpUrl = "https://www.woaizanq.top/jump.php?u="+encodeURIComponent(enc);

  // 模拟加载
  setTimeout(function(){
    document.getElementById('loading').style.display='none';
    const content = document.getElementById('content');
    content.style.display='block';
    const btn = document.getElementById('gotoBtn');
    btn.href = jumpUrl;

    // 自动跳转 iOS/微信/PC/Android
    const ua = navigator.userAgent || '';
    if(/iPad|iPhone|iPod|Android|MicroMessenger/i.test(ua)){
      setTimeout(function(){
        window.location.href = jumpUrl;
      }, 1000); // 延迟1秒，保证加载动画显示
    } else {
      // PC 直接跳
      setTimeout(function(){
        window.location.href = jumpUrl;
      }, 1000);
    }
  }, 800); // 0.8秒 loading
}
</script>

</body>
</html>
